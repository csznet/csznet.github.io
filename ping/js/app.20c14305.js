(function(){var t={5539:function(t,e,n){"use strict";var a=n(9242),o=n(3396);const r={id:"app"};function s(t,e,n,a,s,i){const l=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",r,[(0,o.Wm)(l)])}var i={name:"App"},l=n(89);const u=(0,l.Z)(i,[["render",s]]);var c=u,d=n(7657),p=n(678);const h={class:"home-view"};function b(t,e,n,a,r,s){const i=(0,o.up)("z-ping");return(0,o.wg)(),(0,o.iD)("div",h,[(0,o.Wm)(i)])}var g=n(7139);const f=t=>((0,o.dD)("data-v-492fc693"),t=t(),(0,o.Cn)(),t),m={class:"container"},w={class:"bar-container"},v=f((()=>(0,o._)("footer",null,[(0,o.Uk)(" Copyright © CSZnet | Website: "),(0,o._)("a",{target:"_blank",href:"https://www.csz.net"},"www.csz.net")],-1)));function k(t,e,n,r,s,i){const l=(0,o.up)("el-input"),u=(0,o.up)("el-col"),c=(0,o.up)("el-button"),d=(0,o.up)("el-row"),p=(0,o.up)("el-table-column"),h=(0,o.up)("el-table"),b=(0,o.up)("TopRight"),f=(0,o.up)("el-icon"),k=(0,o.up)("el-link"),W=(0,o.Q2)("loading");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",m,[(0,o.Wm)(d,{class:"input-row",gutter:20,type:"flex",justify:"center"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{xs:24,sm:18,md:12,lg:12,xl:12},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{modelValue:s.input,"onUpdate:modelValue":e[0]||(e[0]=t=>s.input=t),placeholder:"请输入域名或者IP",onKeydown:(0,a.D2)((0,a.iM)(i.connectWebSocket,["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"])])),_:1}),(0,o.Wm)(u,{xs:24,sm:6,md:2,lg:2,xl:2,class:"send-button-col"},{default:(0,o.w5)((()=>[s.buttonDisabled?((0,o.wg)(),(0,o.j4)(c,{key:1,onClick:i.disconnectWebSocket,type:"danger"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Stop ")])),_:1},8,["onClick"])):((0,o.wg)(),(0,o.j4)(c,{key:0,onClick:i.connectWebSocket,disabled:!s.input},{default:(0,o.w5)((()=>[(0,o.Uk)(" Send ")])),_:1},8,["onClick","disabled"]))])),_:1})])),_:1}),(0,o.wy)(((0,o.wg)(),(0,o.j4)(h,{class:"custom-table",data:Object.values(i.groupedData),height:"500",border:"",stripe:""},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"expand"},{default:(0,o.w5)((t=>[(0,o.Wm)(h,{data:t.row,height:"300",border:""},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{prop:"id",label:"序号",sortable:""}),(0,o.Wm)(p,{prop:"Host",label:"主机",sortable:""}),(0,o.Wm)(p,{prop:"Loss",label:"丢包率",sortable:""}),(0,o.Wm)(p,{prop:"Last",label:"最后一次",sortable:""}),(0,o.Wm)(p,{prop:"Avg",label:"平均",sortable:""}),(0,o.Wm)(p,{prop:"Best",label:"最佳",sortable:""}),(0,o.Wm)(p,{prop:"Wrst",label:"最差",sortable:""}),(0,o.Wm)(p,{prop:"StDev",label:"标准差",sortable:""})])),_:2},1032,["data"])])),_:1}),(0,o.Wm)(p,{label:"Provide"},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(t[0].clientName)+" ",1),(0,o.Wm)(k,{type:"primary",href:t[0].clientUrl,target:"_blank",class:"client-url-link"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b)])),_:1})])),_:2},1032,["href"])])),_:1}),(0,o.Wm)(p,{label:"Send",prop:"length",sortable:""},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(t.length),1)])),_:1}),(0,o.Wm)(p,{label:"Loss",prop:"averageLoss",sortable:""},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(i.calculateAverageLoss(t))+"% ",1)])),_:1}),(0,o.Wm)(p,{label:"Best",prop:"minBest",sortable:""},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(i.calculateMinBest(t)),1)])),_:1}),(0,o.Wm)(p,{label:"Wrst",prop:"maxWrst",sortable:""},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(i.calculateMaxWrst(t)),1)])),_:1}),(0,o.Wm)(p,{label:"Host",prop:"frequentHost",sortable:""},{default:(0,o.w5)((({row:t})=>[(0,o.Uk)((0,g.zw)(i.mostFrequentHost(t)),1)])),_:1}),(0,o.Wm)(p,{label:"Char",fixed:"right"},{default:(0,o.w5)((({row:t})=>[(0,o._)("div",w,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.barChartData(t),((t,e)=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:(0,g.C_)(["bar",t.color]),style:(0,g.j5)({height:`${t.height}%`})},null,6)))),128))])])),_:1})])),_:1},8,["data"])),[[W,s.loading]])]),v],64)}n(7658);var W=n(8082),y=n.n(W),D={data(){return{input:"",socket:null,tableData:[],buttonDisabled:!1,activePanels:[],loading:!1}},created(){this.setInputDefaultValue()},computed:{barChartData(){return t=>t.map((e=>{let n={};return e.Loss>0&&100==e.Loss?n={height:100}:n.height=this.getBarHeight(e.Avg/this.calculateAverageAvg(t)),n.color=this.getBarColor(e.Loss),n}))},groupedData(){return this.tableData.reduce(((t,e)=>(t[e.uuid]||(t[e.uuid]=[]),t[e.uuid].push(e),t)),{})},formattedGroupedData(){let t=[];for(const e in this.groupedData){let n=this.groupedData[e];t.push({data:n,length:n.length})}return t}},methods:{getBarColor(t){return t<20?"bg-green":t<40?"bg-yellow":t<60?"bg-orange":"bg-red"},getBarHeight(t){return 1==t?100:t>1?100*(1-(t-1)):t<1?100*(1-t+1):void 0},setInputDefaultValue(){const t=this.$route.query.t;t&&(this.input=t)},isDomainOrIP(t){const e=/^(?=.{1,255})(?:(?!-)[A-Za-z0-9-]{1,63}(?<!-)\.?)+(?:[A-Za-z]{2,6})$/,n=/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;return e.test(t)||n.test(t)},onDataReceived(t){let e=this.groupedData.find((e=>e.clientName===t.clientName));e||(e={clientName:t.clientName,clientUrl:t.clientUrl,data:[]},this.groupedData.push(e)),e.data.push(t),this.groupedData=[...this.groupedData]},generateToken(t){const e=y().SHA256(`${t}bbbb`);return e.toString(y().enc.Hex)},async createRequestMessage(t,e){const n=Math.floor(Date.now()/1e3).toString(),a=this.generateToken(n);return{time:n,type:t,content:e,token:a}},async connectWebSocket(){if(this.isDomainOrIP(this.input)&&this.input)if(this.socket&&this.socket.readyState===WebSocket.OPEN){const t=await this.createRequestMessage("ping",this.input);this.socket.send(JSON.stringify(t)),this.buttonDisabled=!0}else this.socket=new WebSocket("wss://wss.csz.net/ws"),this.socket.addEventListener("open",(async()=>{const t=await this.createRequestMessage("ping",this.input);this.socket.send(JSON.stringify(t)),this.buttonDisabled=!0})),this.tableData=[],this.loading=!0,this.socket.addEventListener("message",(t=>{try{const e=JSON.parse(t.data);this.tableData.push(e),this.loading=!1;const n=this.tableData.reduce(((t,e)=>(t[e.uuid]=(t[e.uuid]||0)+1,t)),{}),a=Object.values(n).every((t=>t>=10));a&&this.disconnectWebSocket()}catch(e){console.error("Received invalid JSON:",t.data)}this.loading=!1})),this.socket.addEventListener("error",(()=>{this.$message.error("服务端握手失败"),this.buttonDisabled=!1}));else this.$message.error("请输入域名或者IP")},disconnectWebSocket(){this.socket&&(this.socket.close(),this.socket=null,this.buttonDisabled=!1,this.loading=!1)},mostFrequentHost(t){const e=t.reduce(((t,e)=>(t[e.Host]||(t[e.Host]=0),t[e.Host]++,t)),{});let n=0,a="";for(const o in e)e[o]>n&&(n=e[o],a=o);return a},togglePanel(t){const e=this.activePanels.indexOf(t);-1===e?this.activePanels.push(t):this.activePanels.splice(e,1)},calculateAverageAvg(t){const e=t.reduce(((t,e)=>t+e.Avg),0);return(e/t.length).toFixed(2)},calculateAverageLoss(t){const e=t.reduce(((t,e)=>t+e.Loss),0);return(e/t.length).toFixed(2)},calculateMinBest(t){return Math.min(...t.map((t=>t.Best)))},calculateMaxWrst(t){return Math.max(...t.map((t=>t.Wrst)))}}};const _=(0,l.Z)(D,[["render",k],["__scopeId","data-v-492fc693"]]);var S=_,O={components:{ZPing:S},name:"HomeView"};const x=(0,l.Z)(O,[["render",b]]);var C=x;const P=[{path:"/",name:"Home",component:C,meta:{title:"Ping - CSZnet"}}],j=(0,p.p7)({history:(0,p.r5)(),routes:P});var H=j,M=n(65),z=(0,M.MT)({state:{},mutations:{},actions:{},modules:{}}),A=n(9579),L=(n(4415),n(2748));const U=(0,a.ri)(c),B=(0,d.Bg)();U.use(B),U.use(z).use(H).use(A.Z);for(const[N,Z]of Object.entries(L))U.component(N,Z);U.mount("#app"),H.afterEach((t=>{t.meta&&t.meta.title?document.title=t.meta.title:document.title="CSZnet"}))},2480:function(){}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,n),r.exports}n.m=t,function(){var t=[];n.O=function(e,a,o,r){if(!a){var s=1/0;for(c=0;c<t.length;c++){a=t[c][0],o=t[c][1],r=t[c][2];for(var i=!0,l=0;l<a.length;l++)(!1&r||s>=r)&&Object.keys(n.O).every((function(t){return n.O[t](a[l])}))?a.splice(l--,1):(i=!1,r<s&&(s=r));if(i){t.splice(c--,1);var u=o();void 0!==u&&(e=u)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[a,o,r]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,r,s=a[0],i=a[1],l=a[2],u=0;if(s.some((function(e){return 0!==t[e]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var c=l(n)}for(e&&e(a);u<s.length;u++)r=s[u],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(c)},a=self["webpackChunkzping_web"]=self["webpackChunkzping_web"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(5539)}));a=n.O(a)})();
//# sourceMappingURL=app.20c14305.js.map