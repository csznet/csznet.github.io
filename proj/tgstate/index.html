<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>tgState | CSZNET</title>

      <link rel="stylesheet" href="/css/main.min.d3c3a37e5ac74e543569a0536c3a6f9a6a16ff2c25a49c6f689488d63e634401.css" integrity="sha256-08OjflrHTlQ1aaBTbDpvmmoW/ywlpJxvaJSI1j5jRAE=" crossorigin="anonymous">


      <script src="/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js" integrity="sha256-I80MfYNyY7nq65buLZzPopadqj&#43;gD6HB/ocBqbhyUaE=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">

</head>
<body>
  <header>
    <h1>CSZNET</h1>

  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/proj/">Proj</a>
    </li>
    </ul>
  </nav>


  </header>
  <main>
    
<div class="post">
  <div class="info">
  <h1>tgState</h1>
  </div>
  <p>使用Telegram机器人和频道作为媒介存储的图床or网盘<br>
最大上传支持20MB，建议配合CloudFlare的缓存+always online使用<br>
支持Vercel一键搭建 &amp; Docker一键部署 &amp; 二进制运行<br>
<a href="https://github.com/csznet/tgState" target="_blank" rel="noopener">开源地址</a></p>
<h1 id="进阶指南">进阶指南</h1>
<h2 id="vercel">Vercel</h2>
<p>vercel默认域名部分地区会有阻断，建议添加自定义域名<br>
使用cname解析到<code>cname-china.vercel-dns.com</code></p>
<h2 id="cloudflare">CloudFlare</h2>
<p><strong>SSL证书访问</strong><br>
目的：解决开启SSL&amp;Cloudflare CDN后重定向过多问题<br>
设置路径：域名-&gt;SSL/TLS-&gt;Overview<br>
设置为Full(strict)<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMUZSV2Wggiieo9_XSgODTLhW6fg-UAAukLAAKrzjBVQ0hH_g6a9OUwBA" alt="SSL证书访问"></p>
<p><strong>完全缓存图片</strong><br>
目的：加快访问速度，减少api请求次数<br>
设置路径：域名-&gt;Rules-&gt;Page Rules-&gt;Create Page Rule<br>
给<code>/d/*</code>设置缓存所有，如下<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMVZSV2jVzUitEjGJz_GjZwprJ-nV8AAuoLAAKrzjBV7g9PeEBhKrkwBA" alt="完全缓存图片"><br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMXZSV2yzXwcPXgwuRctimd5_EDWq8AAuwLAAKrzjBVuAQYIFm1Sv4wBA" alt="完全缓存图片"></p>
<p><strong>控制请求速率</strong><br>
目的：防止刷上传<br>
设置路径：域名-&gt;Security-&gt;WAF-&gt;Rate limiting rules<br>
建议给<code>/api</code>限制在10s不超过2次请求，如下<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMWZSV2nJe5fOA6DZsdez4DAAG_MWbEAALrCwACq84wVaOhPWnmR--HMAQ" alt="控制请求速率"></p>
<p><strong>开启Always Online</strong><br>
目的：当服务宕机后，图片正常访问<br>
设置路径：域名-&gt;Caching-&gt;Configuration-&gt;Always Online
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMYZSV23bs8YRmChLhrs2BLwUWsRZ4AAu4LAAKrzjBVHlJjirBp9hgwBA" alt="开启Always Online"></p>

</div>
<script>

  document.addEventListener("DOMContentLoaded", function() {
      
      const images = document.querySelectorAll(".post img");
  
      
      images.forEach(image => {
          
          const placeholder = document.createElement("div");
          placeholder.classList.add("image-placeholder");
  
          
          const svg = document.createElement("div");
          svg.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1024 1024"><path d="M432.888596 655.403778 359.342127 553.64633C349.598306 540.164971 333.800712 540.16511 324.05699 553.64633L188.471613 741.23959C178.727792 754.72095 184.541661 765.649501 201.457031 765.649501L447.704979 765.649501 822.658642 765.649501C839.583509 765.649501 845.267916 754.74485 835.42945 741.293282L620.563382 447.519305C610.659782 433.978682 594.773609 434.067737 584.935143 447.519305L432.888596 655.403778 432.888596 655.403778Z" fill="#979797"></path><path d="M273.271058 347.873852a58.4 58.4 0 1 0 119.364471 0 58.4 58.4 0 1 0-119.364471 0" fill="#979797"></path><path d="M109.081528 198.668263 914.918473 198.668263C906.5326 198.668263 899.934531 191.991158 899.934531 183.80075L899.934531 840.19925C899.934531 831.991651 906.565377 825.331737 914.918473 825.331737L109.081528 825.331737C117.4674 825.331737 124.065469 832.008842 124.065469 840.19925L124.065469 183.80075C124.065469 192.008349 117.434624 198.668263 109.081528 198.668263ZM64.383234 840.19925C64.383234 864.812398 84.345684 885.013972 109.081528 885.013972L914.918473 885.013972C939.585548 885.013972 959.616766 864.894939 959.616766 840.19925L959.616766 183.80075C959.616766 159.187602 939.654316 138.986028 914.918473 138.986028L109.081528 138.986028C84.414452 138.986028 64.383234 159.105061 64.383234 183.80075L64.383234 840.19925Z" fill="#979797"></path></svg>';
  
          
          placeholder.appendChild(svg);
  
          
          placeholder.style.border = "1px dashed #979797";
          placeholder.style.display = "flex";
          placeholder.style.justifyContent = "center";
          placeholder.style.alignItems = "center";
  
          
          image.parentNode.insertBefore(placeholder, image);
  
          
          const tempImage = new Image();
          tempImage.src = image.src;
  
          tempImage.onload = function() {
              
              const imageWidth = this.width;
              const imageHeight = this.height;
  
              
              placeholder.style.width = imageWidth + "px";
              placeholder.style.maxHeight  = imageHeight + "px";
  
              
              placeholder.parentNode.removeChild(placeholder);
              image.style.display = "block";
          };
          
        tempImage.onerror = function() {
            
            placeholder.innerHTML = '<svg t="1697386885221" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7306" width="200" height="200"><path d="M320 896H242.166667l273.753333-273.746667a21.333333 21.333333 0 0 0 3.16-26.133333L429.653333 447.066667l165.426667-330.86A21.333333 21.333333 0 0 0 576 85.333333H96a53.393333 53.393333 0 0 0-53.333333 53.333334v746.666666a53.393333 53.393333 0 0 0 53.333333 53.333334h224a21.333333 21.333333 0 0 0 0-42.666667zM96 128h445.48L386.253333 438.46a21.333333 21.333333 0 0 0 0.786667 20.513333L474 603.86l-69.333333 69.333333-89.62-89.653333a53.333333 53.333333 0 0 0-75.426667 0L85.333333 737.826667V138.666667a10.666667 10.666667 0 0 1 10.666667-10.666667z m-10.666667 757.333333v-87.166666l184.46-184.453334a10.666667 10.666667 0 0 1 15.08 0L374.5 703.333333l-192.666667 192.666667H96a10.666667 10.666667 0 0 1-10.666667-10.666667z m192-458.666666c58.813333 0 106.666667-47.853333 106.666667-106.666667s-47.853333-106.666667-106.666667-106.666667-106.666667 47.853333-106.666666 106.666667 47.853333 106.666667-106.666666 106.666667 47.853333 106.666667 106.666666 106.666667z m0-170.666667a64 64 0 1 1-64 64 64.073333 64.073333 0 0 1 64-64z m650.666667-128H661.333333a21.333333 21.333333 0 0 0-19.08 11.793333l-0.046666 0.086667c-0.04 0.086667-0.086667 0.173333-0.126667 0.253333L535.586667 353.126667a21.333333 21.333333 0 1 0 38.16 19.08L674.52 170.666667H928a10.666667 10.666667 0 0 1 10.666667 10.666666v471.166667l-154.953334-154.96a53.333333 53.333333 0 0 0-75.426666 0L571.08 634.746667a21.333333 21.333333 0 0 0-3.153333 26.153333l24.666666 41.08-203.646666 244.36A21.333333 21.333333 0 0 0 405.333333 981.333333h522.666667a53.393333 53.393333 0 0 0 53.333333-53.333333V181.333333a53.393333 53.393333 0 0 0-53.333333-53.333333z m0 810.666667H450.88l184.173333-221.006667a21.333333 21.333333 0 0 0 1.906667-24.666667l-23.933333-39.886666 125.433333-125.426667a10.666667 10.666667 0 0 1 15.08 0L938.666667 712.833333V928a10.666667 10.666667 0 0 1-10.666667 10.666667z" fill="#5C5C66" p-id="7307"></path></svg>';

            
            placeholder.style.border = "1px dashed red"; 
        };
      });
  });
  </script>
  


  </main>
  <footer>
    <p>Copyright 2023. All rights reserved.</p>
<a href="/"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="44px" height="15px" viewBox="0 0 44 15" enable-background="new 0 0 44 15" xml:space="preserve">  <image id="image0" width="44" height="15" x="0" y="0"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAPBAMAAABtkjCqAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAKlBMVEUAAAD/////ZgCZmWb/
aAT/+vj/agj//fz8/Pr9/f36+vj/+PT/ZwOammiamlTzAAAAAWJLR0QB/wIt3gAAAAlwSFlzAAAL
EwAACxMBAJqcGAAAAAd0SU1FB+cKDxAqIJ1lxv0AAABtSURBVBjTY2DADhgFsQABBkYlOBA2hgHS
hR1FlRIFiwQFhYQtjC0sBScvFAQLB6kFBQHVaisJW062sACqbYYIKwFVK+kEKQlbXLxhKQgXVgNK
BKkCzbYw7kSoVhRVEhRUQpgNFaaGu7GHCXYAAPxWLJi8tpSVAAAAJXRFWHRkYXRlOmNyZWF0ZQAy
MDIzLTEwLTE1VDE2OjQyOjMyKzAwOjAwPaptfwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0xMC0x
NVQxNjo0MjozMiswMDowMEz31cMAAAAodEVYdGRhdGU6dGltZXN0YW1wADIwMjMtMTAtMTVUMTY6
NDI6MzIrMDA6MDAb4vQcAAAAAElFTkSuQmCC" />
</svg>
</a>
  </footer>
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  
</body>
</html>
