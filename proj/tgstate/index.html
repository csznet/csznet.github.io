<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>tgState | CSZNET</title>

      <link rel="stylesheet" href="/css/main.min.d3c3a37e5ac74e543569a0536c3a6f9a6a16ff2c25a49c6f689488d63e634401.css" integrity="sha256-08OjflrHTlQ1aaBTbDpvmmoW/ywlpJxvaJSI1j5jRAE=" crossorigin="anonymous">


      <script src="/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js" integrity="sha256-I80MfYNyY7nq65buLZzPopadqj&#43;gD6HB/ocBqbhyUaE=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">

</head>
<body>
  <header>
    <h1>CSZNET</h1>

  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/proj/">Proj</a>
    </li>
    </ul>
  </nav>


  </header>
  <main>
    
<div class="post">
  <div class="info">
  <h1>tgState</h1>
  </div>
  <p>使用Telegram机器人和频道作为媒介存储的图床or网盘<br>
最大上传支持20MB，建议配合CloudFlare的缓存+always online使用<br>
支持Vercel一键搭建 &amp; Docker一键部署 &amp; 二进制运行<br>
<a href="https://github.com/csznet/tgState" target="_blank" rel="noopener">开源地址</a></p>
<h1 id="进阶指南">进阶指南</h1>
<h2 id="vercel">Vercel</h2>
<p>vercel默认域名部分地区会有阻断，建议添加自定义域名<br>
使用cname解析到<code>cname-china.vercel-dns.com</code></p>
<h2 id="cloudflare">CloudFlare</h2>
<p><strong>SSL证书访问</strong><br>
目的：解决开启SSL&amp;Cloudflare CDN后重定向过多问题<br>
设置路径：域名-&gt;SSL/TLS-&gt;Overview<br>
设置为Full(strict)<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMUZSV2Wggiieo9_XSgODTLhW6fg-UAAukLAAKrzjBVQ0hH_g6a9OUwBA" alt="SSL证书访问"></p>
<p><strong>完全缓存图片</strong><br>
目的：加快访问速度，减少api请求次数<br>
设置路径：域名-&gt;Rules-&gt;Page Rules-&gt;Create Page Rule<br>
给<code>/d/*</code>设置缓存所有，如下<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMVZSV2jVzUitEjGJz_GjZwprJ-nV8AAuoLAAKrzjBV7g9PeEBhKrkwBA" alt="完全缓存图片"><br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMXZSV2yzXwcPXgwuRctimd5_EDWq8AAuwLAAKrzjBVuAQYIFm1Sv4wBA" alt="完全缓存图片"></p>
<p><strong>控制请求速率</strong><br>
目的：防止刷上传<br>
设置路径：域名-&gt;Security-&gt;WAF-&gt;Rate limiting rules<br>
建议给<code>/api</code>限制在10s不超过2次请求，如下<br>
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMWZSV2nJe5fOA6DZsdez4DAAG_MWbEAALrCwACq84wVaOhPWnmR--HMAQ" alt="控制请求速率"></p>
<p><strong>开启Always Online</strong><br>
目的：当服务宕机后，图片正常访问<br>
设置路径：域名-&gt;Caching-&gt;Configuration-&gt;Always Online
<img src="https://img-static.csz.net/d/BQACAgUAAxkDAAMYZSV23bs8YRmChLhrs2BLwUWsRZ4AAu4LAAKrzjBVHlJjirBp9hgwBA" alt="开启Always Online"></p>

</div>
  


  </main>
  <footer>
    <p>Copyright 2023. All rights reserved.</p>
<a href="/"><img src="/csznet.png" alt="CSZNET"/></a>
  </footer>
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  
</body>
</html>
