<!DOCTYPE html>
<html>
<head>
    <title>Telegram图床</title>
    <meta name="keywords" content="telegram图床,tg图床,免费图床,永久图床,图片外链,免费图片外链,纸飞机图床,电报图床" />
    <meta name="description" content="telegram图床,tg图床,免费图床,永久图床,图片外链,免费图片外链,纸飞机图床,电报图床" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="UTF-8">
    <style>
        #uploadButton,
        #uploadFileLabel {
            display: block;
            max-width: 200px; /* 固定宽度 */
            margin: 0 auto; /* 居中 */
            margin-bottom: 10px; /* 添加底部间距 */
        }

        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        h1 {
            color: #333;
        }

        .custom-file-input {
            display: none;
        }

        .custom-file-label {
            background-color: #007BFF;
            color: #fff;
            padding: 10px 20px;
            cursor: pointer;
        }

        .custom-file-label:hover {
            background-color: #0056b3;
        }

        #uploadButton {
            background-color: #007BFF;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }

        #uploadButton[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #uploadButton:hover {
            background-color: #0056b3;
        }

        #response {
            margin-top: 20px;
            padding: 10px;
        }

        .response-item {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
        }

        .response-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .response-error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        #loading {
            display: none;
        }
        .copy-code{
            margin: 5px;
        }
        .copy-links{
            margin-top: 5px;
        }
        #uploadButton[disabled]:hover {
    background-color: #ccc;
    cursor: not-allowed;
}

    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>上传图片到 Telegram</h1>
    <label for="uploadFile" id="uploadFileLabel" class="custom-file-label">选择文件</label>
    <input type="file" name="image" id="uploadFile" accept=".jpg, .jpeg, .png" class="custom-file-input">
    <button id="uploadButton">上传</button>
    <div id="loading">上传中...</div>
    <div id="response" class="ui-widget">
    </div>

    <script>
// 监听粘贴事件
document.addEventListener('paste', function (e) {
    var items = e.clipboardData.items;
    for (var i = 0; i < items.length; i++) {
        var item = items[i];
        if (item.type.indexOf('image') !== -1) {
            // 获取粘贴的图片文件
            var file = item.getAsFile();
            // 调用上传函数，将file传递给上传逻辑
            $('#uploadFileLabel').text("已选择剪贴板文件").css('background-color', '#0056b3');
            uploadImg(file);
        }
    }
});
$(document).ready(function () {
    $('#uploadFile').change(function () {
        var fileName = $(this).val().split('\\').pop();
        if (fileName) {
            $('#uploadFileLabel').text('已选择文件: ' + fileName).css('background-color', '#0056b3');
        } else {
            $('#uploadFileLabel').text('选择文件').css('background-color', '#007BFF');
        }
    });
    $('#uploadButton').click(function () {
        var fileInput = document.getElementById('uploadFile');
        var file = fileInput.files[0];
        if(file){
            uploadImg(file)
        }else{
            alert('请选择一个图片文件');
        }
    });
});
function uploadImg(file){
    var formData = new FormData();
            formData.append('image', file);
            // 禁用上传按钮并显示loading
            $('#uploadButton').prop('disabled', true);
            $('#uploadButton').text('上传中');
            $('#loading').show();
            var baseUrl = "https://tgtu.ikun123.com";
            $.ajax({
                type: 'POST',
                url: baseUrl+'/api',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response.code === 1) {
                        var imgUrl = baseUrl + response.message;
                        var newItem = $('<div class="response-item response-success">上传成功，图片外链：<a target="_blank" href="' + imgUrl + '">' + imgUrl + '</a>' +
                            '<div class="copy-links">' +
                            '<span class="copy-code" data-clipboard-text="&lt;img src=&quot;' + imgUrl + '&quot; alt=&quot;Your Alt Text&quot;&gt;">HTML</span>' +
                            '<span class="copy-code" data-clipboard-text="![Alt Text](' + imgUrl + ')">Markdown</span>' +
                            '<span class="copy-code" data-clipboard-text="[img]' + imgUrl + '[/img]">BBCode</span>' +
                            '</div></div>');
                        $('#response').prepend(newItem); // 将新数据放在最前面

                        // 清除文件输入框的值
                        $('#uploadFile').val('');
                        $('#uploadFileLabel').text('选择文件').css('background-color', '#007BFF');

                        // 添加复制功能
                        $('.copy-code').click(function () {
                            var textToCopy = $(this).data('clipboard-text');
                            var tempInput = $('<input>');
                            $('body').append(tempInput);
                            tempInput.val(textToCopy).select();
                            document.execCommand('copy');
                            tempInput.remove();

                            // 显示复制成功文本
                            var copyText = $(this);
                            var originalText = copyText.text();
                            copyText.text('复制成功');

                            setTimeout(function () {
                                copyText.text(originalText);
                            }, 1000);
                        });
                    } else {
                        var newItem = $('<div class="response-item response-error">上传失败,错误信息：' + response.message + '</div>');
                        $('#response').prepend(newItem); // 将新数据放在最前面
                    }
                },
                error: function () {
                    var newItem = $('<div class="response-item response-error">上传失败</div>');
                    $('#response').prepend(newItem); // 将新数据放在最前面
                },
                complete: function () {
                    // 启用上传按钮并隐藏loading
                    $('#uploadButton').prop('disabled', false);
                    $('#uploadButton').text('上传');
                    $('#loading').hide();
                }
            });
}
    </script>
    <a href="https://www.csz.net/"><img src="https://www.csz.net/csznet.png"></a>
</body>
</html>
